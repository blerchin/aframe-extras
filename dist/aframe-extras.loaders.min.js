!function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return o(r?r:e)},p,p.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){e("./src/loaders").registerAll()},{"./src/loaders":5}],2:[function(e,t,r){function n(){}function o(){}function i(){}function s(){this.skinIndices=[],this.skinWeights=[],this.matrices=[]}function a(){this.hierarchy=[]}function h(){this.node=null,this.name=null,this.id=null,this.vertices=[],this.indices=[],this.normals=[],this.uvs=[],this.bones=[],this.skins=null}function c(){this.uv=null,this.map=null,this.ref=null,this.node=null,this.index=null}function p(){this.normal=null,this.map=null,this.ref=null,this.node=null,this.index=null}function d(){this.version=null,this.id=null,this.internalId=null,this.times=null,this.values=null,this.attrFlag=null,this.attrData=null}function l(){this.id=null,this.attr=null,this.attrX=!1,this.attrY=!1,this.attrZ=!1,this.internalId=null,this.containerInternalId=null,this.containerBoneId=null,this.curveIdx=null,this.curves=[]}function u(){this.curves={},this.length=0,this.fps=30,this.frames=0}function f(){this.textures=[],this.perGeoMap={}}function m(){this.fileName="",this.name="",this.id=null,this.parentIds=[]}function y(e,t,r){for(var n=[],o=0;o<t.length;++o)for(var i=0;r>i;++i)n.push(e[t[o]*r+i]);return n}function v(e,t,r){for(var n={},o=[],i=0,s=0;s<t.length;++s)if(!(t[s]in n)){n[t[s]]={};for(var a=0;r>a;++a)n[t[s]][a]=e[s*r+a];i=i<t[s]?t[s]:i}try{for(s=0;i>=s;s++)for(var h=0;r>h;h++)o.push(n[s][h])}catch(c){}return o}THREE.FBXLoader=function(e,t){THREE.Loader.call(this,e),this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.textureLoader=null,this.textureBasePath=null},THREE.FBXLoader.prototype=Object.create(THREE.Loader.prototype),THREE.FBXLoader.prototype.constructor=THREE.FBXLoader,THREE.FBXLoader.prototype.load=function(e,t,r,n){var o=this,i=new THREE.XHRLoader(o.manager);i.load(e,function(r){o.isFbxFormatASCII(r)?o.isFbxVersionSupported(r)?(o.textureBasePath=o.extractUrlBase(e),t(o.parse(r))):console.warn("FBXLoader: !!! FBX Version below 7 not supported !!!"):console.warn("FBXLoader: !!! FBX Binary format not supported !!!")},r,n)},THREE.FBXLoader.prototype.setCrossOrigin=function(e){this.crossOrigin=e},THREE.FBXLoader.prototype.isFbxFormatASCII=function(e){CORRECT=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];for(var t=0,r=function(r){var n=e[r-1];return e=e.slice(t+r),t++,n},n=0;n<CORRECT.length;++n)if(num=r(1),num==CORRECT[n])return!1;return!0},THREE.FBXLoader.prototype.isFbxVersionSupported=function(e){var t=/FBXVersion: (\d+)/;if(match=e.match(t),match){var r=parseInt(match[1]);return console.log("FBXLoader: FBX version "+r),r>=7e3}return!1},THREE.FBXLoader.prototype.parse=function(e){var t=this;console.time("FBXLoader"),console.time("FBXLoader: TextParser");var r=(new o).parse(e);console.timeEnd("FBXLoader: TextParser"),console.time("FBXLoader: ObjectParser"),t.hierarchy=(new a).parseHierarchy(r),t.weights=(new s).parse(r,t.hierarchy),t.animations=(new u).parse(r,t.hierarchy),t.textures=(new f).parse(r,t.hierarchy),console.timeEnd("FBXLoader: ObjectParser"),console.time("FBXLoader: GeometryParser"),geometries=this.parseGeometries(r),console.timeEnd("FBXLoader: GeometryParser");for(var n=new THREE.Group,i=0;i<geometries.length;++i)void 0!==geometries[i]&&n.add(geometries[i]);return console.timeEnd("FBXLoader"),n},THREE.FBXLoader.prototype.parseGeometries=function(e){if(!("Geometry"in e.Objects.subNodes))return[];var t=0;for(var r in e.Objects.subNodes.Geometry)r.match(/^\d+$/)&&t++;var n=[];if(t>0)for(r in e.Objects.subNodes.Geometry)"Mesh"===e.Objects.subNodes.Geometry[r].attrType&&n.push(this.parseGeometry(e.Objects.subNodes.Geometry[r],e));else n.push(this.parseGeometry(e.Objects.subNodes.Geometry,e));return n},THREE.FBXLoader.prototype.parseGeometry=function(e,t){geo=(new h).parse(e),geo.addBones(this.hierarchy.hierarchy);var r=new THREE.BufferGeometry;r.name=geo.name,r.addAttribute("position",new THREE.BufferAttribute(new Float32Array(geo.vertices),3)),void 0!==geo.normals&&geo.normals.length>0&&r.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(geo.normals),3)),void 0!==geo.uvs&&geo.uvs.length>0&&r.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(geo.uvs),2)),void 0!==geo.indices&&geo.indices.length>65535?r.setIndex(new THREE.BufferAttribute(new Uint32Array(geo.indices),1)):void 0!==geo.indices&&r.setIndex(new THREE.BufferAttribute(new Uint16Array(geo.indices),1)),r.verticesNeedUpdate=!0,r.computeBoundingSphere(),r.computeBoundingBox();var n,o=this.textures.getById(t.searchConnectionParent(geo.id));void 0!==o&&o.length>0&&(null===this.textureLoader&&(this.textureLoader=new THREE.TextureLoader),n=this.textureLoader.load(this.textureBasePath+"/"+o[0].fileName));var i;i=void 0!==n?new THREE.MeshBasicMaterial({map:n}):new THREE.MeshBasicMaterial({color:3342591}),r=(new THREE.Geometry).fromBufferGeometry(r),r.bones=geo.bones,r.skinIndices=this.weights.skinIndices,r.skinWeights=this.weights.skinWeights;var s=null;return void 0===geo.bones||void 0===geo.skins||void 0===this.animations||0===this.animations.length?s=new THREE.Mesh(r,i):(i.skinning=!0,s=new THREE.SkinnedMesh(r,i),this.addAnimation(s,this.weights.matrices,this.animations)),s},THREE.FBXLoader.prototype.addAnimation=function(e,t,r){for(var n={name:"animationtest",fps:30,length:r.length,hierarchy:[]},o=0;o<e.geometry.bones.length;++o){var i=e.geometry.bones[o].name;i=i.replace(/.*:/,""),n.hierarchy.push({parent:e.geometry.bones[o].parent,name:i,keys:[]})}var s=function(e,t){if(void 0===e)return!1;var r;switch(t){case"S":if(void 0===e.S)return!1;r=e.S;break;case"R":if(void 0===e.R)return!1;r=e.R;break;case"T":if(void 0===e.T)return!1;r=e.T}return void 0===r.curves.x?!1:void 0===r.curves.y?!1:void 0!==r.curves.z},a=function(e,t){var r=h(e.curves.x,t),n=h(e.curves.y,t),o=h(e.curves.z,t);return r&&n&&o},h=function(e,t){var r=e.values[t];return void 0!==r},c=function(e,t){var n={};if(n.time=frame/r.fps,n.pos=t.pos,n.rot=t.rotq,n.scl=t.scl,void 0===e)return n;try{if(s(e,"T")&&a(e.T,frame)){var o=new THREE.Vector3(e.T.curves.x.values[frame],e.T.curves.y.values[frame],e.T.curves.z.values[frame]);n.pos=[o.x,o.y,o.z]}else delete n.pos;if(s(e,"R")&&a(e.R,frame)){var i=degToRad(e.R.curves.x.values[frame]),h=degToRad(e.R.curves.y.values[frame]),c=degToRad(e.R.curves.z.values[frame]),p=new THREE.Vector3(i,h,c),d=quatFromVec(p.x,p.y,p.z);n.rot=[d.x,d.y,d.z,d.w]}else delete n.rot;if(s(e,"S")&&a(e.S,frame)){var l=new THREE.Vector3(e.S.curves.x.values[frame],e.S.curves.y.values[frame],e.S.curves.z.values[frame]);n.scl=[l.x,l.y,l.z]}else delete n.scl}catch(u){console.log(t),console.log(u)}return n},p=e.geometry.bones;for(frame=0;frame<r.frames;frame++)for(o=0;o<p.length;o++)for(var d=p[o],l=r.curves[o],u=0;u<n.hierarchy.length;u++)n.hierarchy[u].name===d.name&&n.hierarchy[u].keys.push(c(l,d));void 0===e.geometry.animations&&(e.geometry.animations=[]),e.geometry.animations.push(THREE.AnimationClip.parseAnimation(n,e.geometry.bones))},THREE.FBXLoader.prototype.parseMaterials=function(e){if(!("Material"in e.subNodes))return[];var t=0;for(var r in e.subNodes.Materials)r.match(/^\d+$/)&&t++;var n=[];if(t>0)for(r in e.subNodes.Material)n.push(parseMaterial(e.subNodes.Material[r]));else n.push(parseMaterial(e.subNodes.Material));return n},THREE.FBXLoader.prototype.parseMaterial=function(e){},THREE.FBXLoader.prototype.loadFile=function(e,t,r,n,o){var i=new THREE.XHRLoader(this.manager);i.setResponseType(o);var s=i.load(e,function(e){t(e)},r,n);return s},THREE.FBXLoader.prototype.loadFileAsBuffer=function(e,t,r,n){this.loadFile(e,onLoad,r,n,"arraybuffer")},THREE.FBXLoader.prototype.loadFileAsText=function(e,t,r,n){this.loadFile(e,t,r,n,"text")},n.prototype.add=function(e,t){this[e]=t},n.prototype.searchConnectionParent=function(e){if(void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]),void 0!==this.__cache_search_connection_parent[e])return this.__cache_search_connection_parent[e];this.__cache_search_connection_parent[e]=[];for(var t=this.Connections.properties.connections,r=[],n=0;n<t.length;++n)if(t[n][0]==e){var o=0===t[n][1]?-1:t[n][1];r.push(o)}return r.length>0?(this.__cache_search_connection_parent[e]=this.__cache_search_connection_parent[e].concat(r),r):(this.__cache_search_connection_parent[e]=[-1],[-1])},n.prototype.searchConnectionChildren=function(e){if(void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]),void 0!==this.__cache_search_connection_children[e])return this.__cache_search_connection_children[e];this.__cache_search_connection_children[e]=[];for(var t=this.Connections.properties.connections,r=[],n=0;n<t.length;++n)t[n][1]==e&&r.push(0===t[n][0]?-1:t[n][0]);return r.length>0?(this.__cache_search_connection_children[e]=this.__cache_search_connection_children[e].concat(r),r):(this.__cache_search_connection_children[e]=[-1],[-1])},n.prototype.searchConnectionType=function(e,t){var r=e+","+t;if(void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type=""),void 0!==this.__cache_search_connection_type[r])return this.__cache_search_connection_type[r];this.__cache_search_connection_type[r]="";for(var n=this.Connections.properties.connections,o=0;o<n.length;++o)if(n[o][0]==e&&n[o][1]==t)return this.__cache_search_connection_type[r]=n[o][2],n[o][2];return this.__cache_search_connection_type[e]=null,null},o.prototype={getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new n,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=e.split("\n");for(var r in t){var o=t[r];if(!o.match(/^[\s\t]*;/)&&!o.match(/^[\s\t]*$/)){var i=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");if(match=o.match(i),match){var s=match[1].trim().replace(/^"/,"").replace(/"$/,""),a=match[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")});this.parseNodeBegin(o,s,a||null)}else{var h=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");if(match=o.match(h),match){var c=match[1].replace(/^"/,"").replace(/"$/,"").trim(),p=match[2].replace(/^"/,"").replace(/"$/,"").trim();this.parseNodeProperty(o,c,p)}else{var d=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");o.match(d)?this.nodeEnd():o.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(o)}}}}return this.allNodes},parseNodeBegin:function(e,t,r){var n={name:t,properties:{},subNodes:{}},o=this.parseNodeAttr(r),i=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(t,n);else if(t in i.subNodes){var s=i.subNodes[t];this.isFlattenNode(i.subNodes[t])&&(""===o.id?(i.subNodes[t]=[],i.subNodes[t].push(s)):(i.subNodes[t]={},i.subNodes[t][s.id]=s)),""===o.id?i.subNodes[t].push(n):i.subNodes[t][o.id]=n}else i.subNodes[t]=n;r&&(n.id=o.id,n.attrName=o.name,n.attrType=o.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r,n;return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r||"",type:n||""}},parseNodeProperty:function(e,t,r){var n=this.getCurrentNode(),o=n.name;if(void 0!==o){var i=o.match(/Properties(\d)+/);if(i)return void this.parseNodeSpecialProperty(e,t,r)}if("C"==t){var s=r.split(",").slice(1),a=parseInt(s[0]),h=parseInt(s[1]),c=r.split(",").slice(3);t="connections",r=[a,h],r=r.concat(c),void 0===n.properties[t]&&(n.properties[t]=[])}if("Node"==t){var p=parseInt(r);n.properties.id=p,n.id=p}t in n.properties?Array.isArray(n.properties[t])?n.properties[t].push(r):n.properties[t]+=r:Array.isArray(n.properties[t])?n.properties[t].push(r):n.properties[t]=r,this.setCurrentProp(n.properties,t)},parseNodePropertyContinued:function(e){this.currentProp[this.currentPropName]+=e},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=n[0],i=n[1],s=n[2],a=n[3],h=n[4];switch(i){case"int":h=parseInt(h);break;case"double":h=parseFloat(h);break;case"ColorRGB":case"Vector3D":var c=h.split(",");h=new THREE.Vector3(c[0],c[1],c[2])}this.getPrevNode().properties[o]={type:i,type2:s,flag:a,value:h},this.setCurrentProp(this.getPrevNode().properties,o)},nodeEnd:function(e){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e}},i.prototype={},s.prototype.parseCluster=function(e,t,r){var n=e.searchConnectionParent(t),o=toInt(r.subNodes.Indexes.properties.a.split(",")),i=toFloat(r.subNodes.Weights.properties.a.split(",")),s=toMat44(toFloat(r.subNodes.Transform.properties.a.split(","))),a=toMat44(toFloat(r.subNodes.TransformLink.properties.a.split(",")));return{parent:n,id:parseInt(t),indices:o,weights:i,transform:s,transformlink:a,linkMode:r.properties.Mode}},s.prototype.parse=function(e,t){this.skinIndices=[],this.skinWeights=[],this.matrices=[];var r=e.Objects.subNodes.Deformer,n={};for(var o in r)if("Cluster"===r[o].attrType){if(!("Indexes"in r[o].subNodes))continue;var i=this.parseCluster(e,o,r[o]),s=e.searchConnectionChildren(i.id)[0];n[s]=i}for(var a=[],h=t.hierarchy,c=0;c<h.length;++c){var p=h[c].internalId;if(void 0!==n[p]){var d=n[p];this.matrices.push(d.transform);for(var l=0;l<d.indices.length;++l){void 0===a[d.indices[l]]&&(a[d.indices[l]]={},a[d.indices[l]].joint=[],a[d.indices[l]].weight=[]);var u=e.searchConnectionChildren(d.id);u.length>1&&console.warn("FBXLoader: node "+d.id+" have many weight kids: "+u),a[d.indices[l]].joint.push(t.getBoneIdfromInternalId(e,u[0])),a[d.indices[l]].weight.push(d.weights[l])}}else this.matrices.push(new THREE.Matrix4)}for(var f=0;f<a.length;f++){var m=new THREE.Vector4(a[f].joint[0]?a[f].joint[0]:0,a[f].joint[1]?a[f].joint[1]:0,a[f].joint[2]?a[f].joint[2]:0,a[f].joint[3]?a[f].joint[3]:0),y=new THREE.Vector4(a[f].weight[0]?a[f].weight[0]:0,a[f].weight[1]?a[f].weight[1]:0,a[f].weight[2]?a[f].weight[2]:0,a[f].weight[3]?a[f].weight[3]:0);this.skinIndices.push(m),this.skinWeights.push(y)}return this},a.prototype.parseHierarchy=function(e){var t=e.Objects,r=t.subNodes.Model,n=[];for(var o in r)void 0!==r[o].attrType&&n.push(r[o]);this.hierarchy=[];for(var i=0;i<n.length;++i){var s=n[i],a=e.searchConnectionParent(s.id)[0],h=[0,0,0],c=[0,0,0,1],p=[1,1,1];if("Lcl_Translation"in s.properties&&(h=toFloat(s.properties.Lcl_Translation.value.split(","))),"Lcl_Rotation"in s.properties){c=toRad(toFloat(s.properties.Lcl_Rotation.value.split(",")));var d=new THREE.Quaternion;d.setFromEuler(new THREE.Euler(c[0],c[1],c[2],"ZYX")),c=[d.x,d.y,d.z,d.w]}"Lcl_Scaling"in s.properties&&(p=toFloat(s.properties.Lcl_Scaling.value.split(",")));var l=s.attrName;l=l.replace(/:/,""),l=l.replace(/_/,""),l=l.replace(/-/,""),this.hierarchy.push({parent:a,name:l,pos:h,rotq:c,scl:p,internalId:s.id})}return this.reindexParentId(),this.restoreBindPose(e),this},a.prototype.reindexParentId=function(){for(var e=0;e<this.hierarchy.length;e++)for(var t=0;t<this.hierarchy.length;++t)if(this.hierarchy[e].parent==this.hierarchy[t].internalId){this.hierarchy[e].parent=t;break}},a.prototype.restoreBindPose=function(e){var t=e.Objects.subNodes.Pose;if(void 0!==t){for(var r=t.subNodes.PoseNode,n={},o={},i=0;i<r.length;++i){var s=toMat44(r[i].subNodes.Matrix.properties.a.split(",")),a=toMat44(r[i].subNodes.Matrix.properties.a.split(","));n[r[i].id]=s,o[r[i].id]=a}for(var h=0;h<this.hierarchy.length;++h){var c=this.hierarchy[h],p=c.internalId;if(void 0!==o[p]){for(var d,l=new THREE.Vector3(0,0,0),u=new THREE.Quaternion,f=new THREE.Vector3(1,1,1),m=e.searchConnectionParent(p),y=0;y<m.length;++y)if(this.isBoneNode(m[y])){d=m[y];break}if(void 0!==d&&void 0!==n[d]){var v=new THREE.Matrix4;v.getInverse(o[d]),v.multiply(n[p]),n[p]=v}n[p].decompose(l,u,f),c.pos=[l.x,l.y,l.z],c.rotq=[u.x,u.y,u.z,u.w],c.scl=[f.x,f.y,f.z]}}}},a.prototype.searchRealId=function(e){for(var t=0;t<this.hierarchy.length;t++)if(e==this.hierarchy[t].internalId)return t;return-1},a.prototype.getByInternalId=function(e){for(var t=0;t<this.hierarchy.length;t++)if(e==this.hierarchy[t].internalId)return this.hierarchy[t];return null},a.prototype.isBoneNode=function(e){for(var t=0;t<this.hierarchy.length;++t)if(e===this.hierarchy[t].internalId)return!0;return!1},a.prototype.getBoneIdfromInternalId=function(e,t){if(void 0===e.__cache_get_boneid_from_internalid&&(e.__cache_get_boneid_from_internalid=[]),void 0!==e.__cache_get_boneid_from_internalid[t])return e.__cache_get_boneid_from_internalid[t];for(var r=0;r<this.hierarchy.length;++r)if(this.hierarchy[r].internalId==t){return e.__cache_get_boneid_from_internalid[t]=r,r}return-1},h.prototype.parse=function(e){return this.node=e,this.name=e.attrName,this.id=e.id,this.vertices=this.getVertices(),void 0===this.vertices?void console.log("FBXLoader: Geometry.parse(): pass"+this.node.id):(this.indices=this.getPolygonVertexIndices(),this.uvs=(new c).parse(this.node,this),this.normals=(new p).parse(this.node,this),this.getPolygonTopologyMax()>3&&(this.indices=this.convertPolyIndicesToTri(this.indices,this.getPolygonTopologyArray())),this)},h.prototype.getVertices=function(){if(this.node.__cache_vertices)return this.node.__cache_vertices;if(void 0===this.node.subNodes.Vertices)return console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have Vertices"),this.node.__cache_vertices=void 0,null;var e=this.node.subNodes.Vertices.properties.a,t=e.split(",").map(function(e){return parseFloat(e)});return this.node.__cache_vertices=t,this.node.__cache_vertices},h.prototype.getPolygonVertexIndices=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_indices;if(void 0===this.node.subNodes)return console.error("this.node.subNodes undefined"),void console.log(this.node);if(void 0===this.node.subNodes.PolygonVertexIndex)return console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have PolygonVertexIndex "),void(this.node.__cache_indices=void 0);for(var e=this.node.subNodes.PolygonVertexIndex.properties.a,t=e.split(","),r=1,n=null,o=[],i=0;i<t.length;++i){var s=parseInt(t[i]);0>s?(r>n&&(n=r),t[i]=-1^s,o.push(r),r=1):(t[i]=s,r++)}return null===n&&(console.warn("FBXLoader: topology N not found: "+this.node.attrName),console.warn(this.node),n=3),this.node.__cache_poly_topology_max=n,this.node.__cache_poly_topology_arr=o,this.node.__cache_indices=t,this.node.__cache_indices},h.prototype.getPolygonTopologyMax=function(){return this.node.__cache_indices&&this.node.__cache_poly_topology_max?this.node.__cache_poly_topology_max:(this.getPolygonVertexIndices(this.node),this.node.__cache_poly_topology_max)},h.prototype.getPolygonTopologyArray=function(){return this.node.__cache_indices&&this.node.__cache_poly_topology_max?this.node.__cache_poly_topology_arr:(this.getPolygonVertexIndices(this.node),this.node.__cache_poly_topology_arr)},h.prototype.convertPolyIndicesToTri=function(e,t){for(var r=[],n=0,o=0,i=0;n<e.length;){i=t[o];for(var s=0;i-3>=s;s++)r.push(e[n]),r.push(e[n+(i-2-s)]),r.push(e[n+(i-1-s)]);o++,n+=i}return r},h.prototype.addBones=function(e){this.bones=e},c.prototype.getUV=function(e){return this.node&&this.uv&&this.map&&this.ref?this.uv:this._parseText(e)},c.prototype.getMap=function(e){return this.node&&this.uv&&this.map&&this.ref?this.map:(this._parseText(e),this.map)},c.prototype.getRef=function(e){return this.node&&this.uv&&this.map&&this.ref?this.ref:(this._parseText(e),this.ref)},c.prototype.getIndex=function(e){return this.node&&this.uv&&this.map&&this.ref?this.index:(this._parseText(e),this.index)},c.prototype.getNode=function(e){return null!==this.node?this.node:(this.node=e.subNodes.LayerElementUV,this.node)},c.prototype._parseText=function(e){var t=this.getNode(e);if(void 0===t)return[];var r=0,n="";for(var o in t)o.match(/^\d+$/)&&(r++,n=o);r>0&&(console.warn("multi uv not supported"),t=t[o]);var i=t.subNodes.UVIndex.properties.a,s=t.subNodes.UV.properties.a,a=t.properties.MappingInformationType,h=t.properties.ReferenceInformationType;return this.uv=toFloat(s.split(",")),this.index=toInt(i.split(",")),this.map=a,this.ref=h,this.uv},c.prototype.parse=function(e,t){this.uvNode=this.getNode(e),this.uv=this.getUV(e);var r=this.getMap(e),n=this.getRef(e),o=this.getIndex(e),i=t.getPolygonTopologyArray();switch(r){case"ByPolygonVertex":switch(n){case"Direct":this.uv=this.parseUV_ByPolygonVertex_Direct(this.uv,o,i,2);break;case"IndexToDirect":this.uv=this.parseUV_ByPolygonVertex_IndexToDirect(this.uv,o)}this.uv=v(this.uv,t.getPolygonVertexIndices(e),2);break;case"ByPolygon":switch(n){case"Direct":this.uv=this.parseUV_ByPolygon_Direct();break;case"IndexToDirect":this.uv=this.parseUV_ByPolygon_IndexToDirect()}}return this.uv},c.prototype.parseUV_ByPolygonVertex_Direct=function(e,t,r,n){return parse_Data_ByPolygonVertex_Direct(e,t,r,n)},c.prototype.parseUV_ByPolygonVertex_IndexToDirect=function(e,t){return y(e,t,2)},c.prototype.parseUV_ByPolygon_Direct=function(e){return console.warn("not implemented"),e},c.prototype.parseUV_ByPolygon_IndexToDirect=function(e){return console.warn("not implemented"),e},c.prototype.parseUV_ByVertex_Direct=function(e){return console.warn("not implemented"),e},p.prototype.getNormal=function(e){return this.node&&this.normal&&this.map&&this.ref?this.normal:(this._parseText(e),this.normal)},p.prototype.getMap=function(e){return this.node&&this.normal&&this.map&&this.ref?this.map:(this._parseText(e),this.map)},p.prototype.getRef=function(e){return this.node&&this.normal&&this.map&&this.ref?this.ref:(this._parseText(e),this.ref)},p.prototype.getNode=function(e){return this.node?this.node:(this.node=e.subNodes.LayerElementNormal,this.node)},p.prototype._parseText=function(e){var t=this.getNode(e);if(void 0===t)return void console.warn("node: "+e.attrName+"("+e.id+") does not have LayerElementNormal");var r=t.properties.MappingInformationType,n=t.properties.ReferenceInformationType,o=t.subNodes.Normals.properties.a;this.normal=toFloat(o.split(",")),this.map=r,this.ref=n},p.prototype.parse=function(e,t){var r=this.getNormal(e),n=(this.getNode(e),this.getMap(e)),o=this.getRef(e),i=t.getPolygonVertexIndices(e),s=t.getPolygonTopologyArray(e);switch(n){case"ByPolygonVertex":switch(o){case"Direct":r=this.parseNormal_ByPolygonVertex_Direct(r,i,s,3);break;case"IndexToDirect":r=this.parseNormal_ByPolygonVertex_IndexToDirect()}break;case"ByPolygon":switch(o){case"Direct":r=this.parseNormal_ByPolygon_Direct();break;case"IndexToDirect":r=this.parseNormal_ByPolygon_IndexToDirect()}}return r},p.prototype.parseNormal_ByPolygonVertex_Direct=function(e,t,r,n){return parse_Data_ByPolygonVertex_Direct(e,t,r,n)},p.prototype.parseNormal_ByPolygonVertex_IndexToDirect=function(e){return console.warn("not implemented"),e},p.prototype.parseNormal_ByPolygon_Direct=function(e){return console.warn("not implemented"),e},p.prototype.parseNormal_ByPolygon_IndexToDirect=function(e){return console.warn("not implemented"),e},p.prototype.parseNormal_ByVertex_Direct=function(e){return console.warn("not implemented"),e},d.prototype.fromNode=function(e){return this.id=e.id,this.internalId=e.id,this.times=e.subNodes.KeyTime.properties.a,this.values=e.subNodes.KeyValueFloat.properties.a,this.attrFlag=e.subNodes.KeyAttrFlags.properties.a,this.attrData=e.subNodes.KeyAttrDataFloat.properties.a,this.times=toFloat(this.times.split(",")),this.values=toFloat(this.values.split(",")),this.attrData=toFloat(this.attrData.split(",")),this.attrFlag=toInt(this.attrFlag.split(",")),this.times=this.times.map(function(e){return _(e)}),this},d.prototype.getLength=function(){return this.times[this.times.length-1]},l.prototype.fromNode=function(e,t,r){if(this.id=t.id,this.attr=t.attrName,this.internalId=t.id,!this.attr.match(/S|R|T/))return null;for(var n in t.properties)n.match(/X/)&&(this.attrX=!0),n.match(/Y/)&&(this.attrY=!0),n.match(/Z/)&&(this.attrZ=!0);this.containerIndices=e.searchConnectionParent(this.id),this.curveIdx=e.searchConnectionChildren(this.id);for(var o=this.containerIndices.length-1;o>=0;--o){var i=r.searchRealId(this.containerIndices[o]);if(i>=0&&(this.containerBoneId=i,this.containerId=this.containerIndices[o]),i>=0)break}return this},l.prototype.setCurve=function(e){this.curves.push(e)},u.prototype.parse=function(e,t){var r=e.Objects.subNodes.AnimationCurveNode,n=e.Objects.subNodes.AnimationCurve,o=[];for(var i in r)if(i.match(/\d+/)){var s=(new l).fromNode(e,r[i],t);o.push(s)}for(var a={},h=0;h<o.length;++h)null!==o[h]&&(a[o[h].id]=o[h]);var c=[],p=0;for(i in n)if(i.match(/\d+/)){var u=(new d).fromNode(n[i]);c.push(u),p=u.getLength()?u.getLength():p;var f=e.searchConnectionParent(u.id)[0],m=e.searchConnectionType(u.id,f);m.match(/X/)&&(m="x"),m.match(/Y/)&&(m="y"),m.match(/Z/)&&(m="z"),a[f].curves[m]=u}for(var y in a){var v=a[y].containerBoneId;void 0===this.curves[v]&&(this.curves[v]={}),this.curves[v][a[y].attr]=a[y]}return this.length=p,this.frames=this.length*this.fps,this},f.prototype.add=function(e){void 0===this.textures&&(this.textures=[]),this.textures.push(e);for(var t=0;t<e.parentIds.length;++t)void 0===this.perGeoMap[e.parentIds[t]]&&(this.perGeoMap[e.parentIds[t]]=[]),this.perGeoMap[e.parentIds[t]].push(this.textures[this.textures.length-1])},f.prototype.parse=function(e,t){var r=e.Objects.subNodes.Texture;r=Array.isArray(r)?r:[r];for(var n in r){var o=(new m).parse(r[n],e);this.add(o)}return this},f.prototype.getById=function(e){return this.perGeoMap[e]},m.prototype.parse=function(e,t){return this.id=e.id,this.name=e.attrName,this.fileName=this.parseFileName(e.properties.FileName),this.parentIds=this.searchParents(this.id,t),this},m.prototype.parseFileName=function(e){if(void 0===e)return"";var t=e.split(/[\\\/]/);return t.length>0?t[t.length-1]:e},m.prototype.searchParents=function(e,t){var r=t.searchConnectionParent(e);return r},parse_Data_ByPolygonVertex_Direct=function(e,t,r,n){for(var o=[],i=0,s=0;s<t.length;++s){o[t[s]]=[];for(var a=0;n>a;++a)o[t[s]][a]=e[i+a];i+=n}for(var h=[],c=0;c<o.length;++c)if(void 0!==o[c])for(var p=0;n>p;++p)void 0!==o[c][p]&&h.push(o[c][p]);return h};var _=function(e){return e/46186158e3};degToRad=function(e){return e*Math.PI/180},radToDeg=function(e){return 180*e/Math.PI},quatFromVec=function(e,t,r){var n=new THREE.Euler(e,t,r,"ZYX"),o=new THREE.Quaternion;return o.setFromEuler(n),o},toInt=function(e){return e.map(function(e){return parseInt(e)})},toFloat=function(e){return e.map(function(e){return parseFloat(e)})},toRad=function(e){return e.map(function(e){return degToRad(e)})},toMat44=function(e){var t=new THREE.Matrix4;return t.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),t},t.exports=THREE.FBXLoader},{}],3:[function(e,t,r){t.exports=THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,n){var o=this,i=new THREE.XHRLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){t(o.parse(e))},r,n)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},bin2str:function(e){for(var t=new Uint8Array(e),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(t[n]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return"ascii"===t.format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){function t(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}var r=/ply([\s\S]*)end_header\s/,n="",o=0,i=r.exec(e);null!==i&&(n=i[1],o=i[0].length);for(var s,a,h={comments:[],elements:[],headerLength:o},c=n.split("\n"),p=void 0,d=0;d<c.length;d++){var l=c[d];if(l=l.trim(),""!==l)switch(a=l.split(/\s+/),s=a.shift(),l=a.join(" "),s){case"format":h.format=a[0],h.version=a[1];break;case"comment":h.comments.push(l);break;case"element":void 0!==p&&h.elements.push(p),p=Object(),p.name=a[0],p.count=parseInt(a[1]),p.properties=[];break;case"property":p.properties.push(t(a,this.propertyNameMapping));break;default:console.log("unhandled",s,a)}}return void 0!==p&&h.elements.push(p),h},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var r=t.split(/\s+/),n=Object(),o=0;o<e.length;o++)if("list"===e[o].type){for(var i=[],s=this.parseASCIINumber(r.shift(),e[o].countType),a=0;s>a;a++)i.push(this.parseASCIINumber(r.shift(),e[o].itemType));n[e[o].name]=i}else n[e[o].name]=this.parseASCIINumber(r.shift(),e[o].type);return n},parseASCII:function(e){var t,r=new THREE.Geometry,n=this.parseHeader(e),o=/end_header\s([\s\S]*)$/,i="";null!==(t=o.exec(e))&&(i=t[1]);var s=i.split("\n"),a=0,h=0;r.useColor=!1;for(var c=0;c<s.length;c++){var p=s[c];if(p=p.trim(),""!==p){h>=n.elements[a].count&&(a++,h=0);var d=this.parseASCIIElement(n.elements[a].properties,p);this.handleElement(r,n.elements[a].name,d),h++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){if("vertex"===t){if(e.vertices.push(new THREE.Vector3(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r){e.useColor=!0;var n=new THREE.Color;n.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(n)}}else if("face"===t){var o=r.vertex_indices||r.vertex_index;3===o.length?e.faces.push(new THREE.Face3(o[0],o[1],o[2])):4===o.length&&e.faces.push(new THREE.Face3(o[0],o[1],o[3]),new THREE.Face3(o[1],o[2],o[3]))}},binaryRead:function(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}},binaryReadElement:function(e,t,r,n){for(var o,i=Object(),s=0,a=0;a<r.length;a++)if("list"===r[a].type){var h=[];o=this.binaryRead(e,t+s,r[a].countType,n);var c=o[0];s+=o[1];for(var p=0;c>p;p++)o=this.binaryRead(e,t+s,r[a].itemType,n),h.push(o[0]),s+=o[1];i[r[a].name]=h}else o=this.binaryRead(e,t+s,r[a].type,n),i[r[a].name]=o[0],s+=o[1];return[i,s]},parseBinary:function(e){for(var t,r=new THREE.Geometry,n=this.parseHeader(this.bin2str(e)),o="binary_little_endian"===n.format,i=new DataView(e,n.headerLength),s=0,a=0;a<n.elements.length;a++)for(var h=0;h<n.elements[a].count;h++){t=this.binaryReadElement(i,s,n.elements[a].properties,o),s+=t[1];var c=t[0];this.handleElement(r,n.elements[a].name,c)}return this.postProcess(r)}}},{}],4:[function(e,t,r){THREE.FBXLoader=e("../../lib/FBXLoader"),t.exports={schema:{src:{type:"src"}},init:function(){this.model=null},update:function(){var e,t=this.data;t.src&&(this.remove(),e=new THREE.FBXLoader,e.load(t.src,this.load.bind(this)))},load:function(e){this.model=e,
this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}},{"../../lib/FBXLoader":2}],5:[function(e,t,r){t.exports={"fbx-model":e("./fbx-model"),"ply-model":e("./ply-model"),"three-model":e("./three-model"),registerAll:function(e){this._registered||(e=e||window.AFRAME,e=e.aframeCore||e,e.components["fbx-model"]||e.registerComponent("fbx-model",this["fbx-model"]),e.components["ply-model"]||e.registerComponent("ply-model",this["ply-model"]),e.components["three-model"]||e.registerComponent("three-model",this["three-model"]),this._registered=!0)}}},{"./fbx-model":4,"./ply-model":6,"./three-model":7}],6:[function(e,t,r){THREE.PLYLoader=e("../../lib/PLYLoader"),t.exports={schema:{src:{type:"src"}},init:function(){this.model=null},update:function(){var e,t=this.data;t.src&&(this.remove(),e=new THREE.PLYLoader,e.load(t.src,this.load.bind(this)))},load:function(e){this.model=new THREE.Mesh(e,new THREE.MeshPhongMaterial({color:16777215,shading:THREE.FlatShading,vertexColors:THREE.VertexColors,shininess:0})),this.el.setObject3D("mesh",this.model),this.el.emit("model-loaded",{format:"ply",model:this.model})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}},{"../../lib/PLYLoader":3}],7:[function(e,t,r){t.exports={schema:{src:{type:"src"},loader:{"default":"object",oneOf:["object","json"]},animation:{"default":""}},init:function(){this.model=null,this.mixer=null},update:function(){var e,t=this.data;if(t.src)if(this.remove(),"object"===t.loader)e=new THREE.ObjectLoader,e.load(t.src,this.load.bind(this));else{if("json"!==t.loader)throw new Error('[three-model] Invalid mode "%s".',t.mode);e=new THREE.JSONLoader,e.load(t.src,function(e,t){this.load(new THREE.Mesh(e,new THREE.MeshFaceMaterial(t)))}.bind(this))}},load:function(e){this.model=e,this.mixer=new THREE.AnimationMixer(this.model),this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"three",model:e}),this.data.animation&&this.playAnimation()},playAnimation:function(){var e=this.data,t=this.model.animations||this.model.geometry.animations,r=THREE.AnimationClip.findByName(t,e.animation);this.model.activeAction=this.mixer.clipAction(r,this.model).play()},remove:function(){this.mixer&&this.mixer.stopAllAction(),this.model&&this.el.removeObject3D("mesh")},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}}},{}]},{},[1]);